AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'MovierBack

  Sample SAM Template for MovierBack

  '
Globals:
  Function:
    Timeout: 3
    MemorySize: 128
Resources:
  LambdaExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
          Action: sts:AssumeRole
      Policies:
      - PolicyName: LambdaBasicExecution
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - logs:CreateLogGroup
            - logs:CreateLogStream
            - logs:PutLogEvents
            Resource: arn:aws:logs:*:*:*
  MovieApi:
    Type: AWS::Serverless::Api
    Properties:
      Name: MovieApi
      StageName: Prod
  CommentApi:
    Type: AWS::Serverless::Api
    Properties:
      Name: CommentApi
      StageName: Prod
  HelloWorldFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: HelloWorldFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        HelloWorld:
          Type: Api
          Properties:
            Path: /hello
            Method: get
    Metadata:
      SamResourceId: HelloWorldFunction
  CreateMovieFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: CreateMovieFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        CreateMovie:
          Type: Api
          Properties:
            Path: /create
            RestApiId:
              Ref: MovieApi
            Method: post
    Metadata:
      SamResourceId: CreateMovieFunction
  GetMovieFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: GetMovieFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        CreateMovie:
          Type: Api
          Properties:
            Path: /getAll
            RestApiId:
              Ref: MovieApi
            Method: get
    Metadata:
      SamResourceId: GetMovieFunction
  DisableMovieFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: DisableMovieFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        CreateMovie:
          Type: Api
          Properties:
            Path: /disable/{id}
            RestApiId:
              Ref: MovieApi
            Method: put
    Metadata:
      SamResourceId: DisableMovieFunction
  EnableMovieFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: EnableMovieFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        CreateMovie:
          Type: Api
          Properties:
            Path: /enable/{id}
            RestApiId:
              Ref: MovieApi
            Method: put
    Metadata:
      SamResourceId: EnableMovieFunction
  UpdateMovieFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: UpdateMovieFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        UpdateMovie:
          Type: Api
          Properties:
            Path: /update/{id}
            RestApiId:
              Ref: MovieApi
            Method: put
    Metadata:
      SamResourceId: UpdateMovieFunction
  CreateCommentFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: CreateCommentFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        CreateComment:
          Type: Api
          Properties:
            Path: /create
            RestApiId:
              Ref: CommentApi
            Method: post
    Metadata:
      SamResourceId: CreateCommentFunction
  GetCommentsFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: GetCommentsFunction
      Handler: app.lambda_handler
      Runtime: python3.11
      Architectures:
      - x86_64
      Events:
        GetComments:
          Type: Api
          Properties:
            Path: /getAll
            RestApiId:
              Ref: CommentApi
            Method: get
    Metadata:
      SamResourceId: GetCommentsFunction
Outputs:
  HelloWorldApi:
    Description: API Gateway endpoint URL for Prod stage for Hello World function
    Value:
      Fn::Sub: https://${MovieApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/hello/
  HelloWorldFunction:
    Description: Hello World Lambda Function ARN
    Value:
      Fn::GetAtt:
      - HelloWorldFunction
      - Arn
  CreateMovieApi:
    Description: API Gateway endpoint URL for Prod stage for create movie function
    Value:
      Fn::Sub: https://${MovieApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/create
  CreateMovieFunction:
    Description: Create Movie Lambda Function ARN
    Value:
      Fn::GetAtt:
      - CreateMovieFunction
      - Arn
  GetMovieApi:
    Description: API Gateway endpoint URL for Prod stage for create movie function
    Value:
      Fn::Sub: https://${MovieApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/getAll
  GetMovieFunction:
    Description: Get Movie Lambda Function ARN
    Value:
      Fn::GetAtt:
      - GetMovieFunction
      - Arn
  DisableMovieApi:
    Description: API Gateway endpoint URL for Prod stage for create movie function
    Value:
      Fn::Sub: https://${MovieApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/disable/{id}
  DisableMovieFunction:
    Description: Get Movie Lambda Function ARN
    Value:
      Fn::GetAtt:
      - DisableMovieFunction
      - Arn
  EnableMovieApi:
    Description: API Gateway endpoint URL for Prod stage for create movie function
    Value:
      Fn::Sub: https://${MovieApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/enable/{id}
  EnableMovieFunction:
    Description: Get Movie Lambda Function ARN
    Value:
      Fn::GetAtt:
      - EnableMovieFunction
      - Arn
  UpdateMovieApi:
    Description: API Gateway endpoint URL for Prod stage for update movie function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/update/{id}
  UpdateMovieFunction:
    Description: Update Movie Lambda Function ARN
    Value:
      Fn::GetAtt:
      - UpdateMovieFunction
      - Arn
  CreateCommentApi:
    Description: API Gateway endpoint URL for Prod stage for create comment function
    Value:
      Fn::Sub: https://${CommentApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/create
  CreateCommentFunction:
    Description: Create Comment Lambda Function ARN
    Value:
      Fn::GetAtt:
      - CreateCommentFunction
      - Arn
  GetCommentsApi:
    Description: API Gateway endpoint URL for Prod stage for create movie function
    Value:
      Fn::Sub: https://${CommentApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/getAll
  GetCommentsFunction:
    Description: Get Comments Lambda Function ARN
    Value:
      Fn::GetAtt:
      - GetCommentsFunction
      - Arn
  LambdaExecutionRole:
    Description: Implicit IAM Role created for lambdas functions
    Value:
      Fn::GetAtt:
      - LambdaExecutionRole
      - Arn
